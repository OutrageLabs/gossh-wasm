services:
  sshserver:
    # Use pinned image tags/digests via env vars.
    image: ${SSHSERVER_IMAGE:?Set SSHSERVER_IMAGE to a pinned image tag or digest}
    environment:
      PUID: 1000
      PGID: 1000
      USER_NAME: testuser
      USER_PASSWORD: testpass
      PASSWORD_ACCESS: "true"
    ports:
      - "2222:2222"

  wsproxy:
    image: ${WSPROXY_GO_IMAGE:?Set WSPROXY_GO_IMAGE to a pinned image tag or digest}
    working_dir: /app
    volumes:
      - ../wsproxy:/app
    command: go run .
    ports:
      - "8080:8080"
    environment:
      PORT: "8080"
      ALLOWED_ORIGINS: "http://localhost:8888,http://127.0.0.1:8888"
      BLOCKED_TARGETS: "169.254.0.0/16"
    depends_on:
      - sshserver

  # Serve WASM files for browser testing
  webserver:
    image: ${WEBSERVER_IMAGE:?Set WEBSERVER_IMAGE to a pinned image tag or digest}
    volumes:
      - .:/usr/share/nginx/html:ro
    ports:
      - "8888:80"
    depends_on:
      - wsproxy
